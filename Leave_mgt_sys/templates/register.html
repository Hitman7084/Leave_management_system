{% extends "index.html" %}
{% load static %}
{% block title %}Register{% endblock %}

{% block content %}

<div class="register-container">
    <h2> Register </h2>
    <form method="POST" action="{% url 'register' %}" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-group">
            <label for="id_username">Username:</label>
            <input type="text" name="username" class="form-register" required id="id_username">
        </div>
        <div class="form-group">
            <label for="id_full_name">Full Name:</label>
            <input type="text" name="full_name" class="form-register" required id="id_full_name">
        </div>
        <div class="form-group">
            <label for="id_email">Email:</label>
            <input type="email" name="email" class="form-register" required id="id_email">
            <button type="button" id="verify-email-btn" class="btn-verify">Verify Email</button>
            <span id="email-verified" style="display:none; color: green;">âœ”</span>
        </div>
        <div class="form-group" id="otp-section" style="display:none;">
            <label for="id_otp">Enter OTP:</label>
            <input type="text" name="otp" class="form-register" id="id_otp">
        </div>
        <div class="form-group">
            <label for="id_photo">Photo:</label>
            <input type="file" name="photo" class="form-register" required id="id_photo">
        </div>
        <div class="form-group">
            <label for="id_role">Role:</label>
            <select name="role" class="form-register" required id="id_role">
                <option value="Professor">Professor</option>
                <option value="Dean">Dean</option>
                <option value="Incharge">Incharge</option>
                <option value="Student">Student</option>
            </select>
        </div>
        <div class="form-group">
            <label for="id_password1">Password:</label>
            <input type="password" name="password1" class="form-register" required id="id_password1">
        </div>
        <div class="form-group">
            <label for="id_password2">Confirm Password:</label>
            <input type="password" name="password2" class="form-register" required id="id_password2">
        </div>
        <button type="submit"> Register </button>
    </form>
</div>

<script>
document.getElementById('verify-email-btn').addEventListener('click', function() {
    var email = document.getElementById('id_email').value;
    if (email) {
        fetch("{% url 'send_otp' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({ email: email })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('email-verified').style.display = 'inline';
                document.getElementById('otp-section').style.display = 'block';
            } else {
                alert('Failed to send OTP. Please try again.');
            }
        });
    } else {
        alert('Please enter an email address.');
    }
});
</script>

{% endblock %}